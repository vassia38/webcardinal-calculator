import{i as t,e,h as n,g as i,f as o}from"./p-5f16beec.js";import{V as r,b as s,c as a,e as c,g as u,f,d as l}from"./p-61cc1f50.js";import"./p-0c3518a5.js";const d=new Map;function h(t){let e=t.hasAttribute(r)?t.getAttribute(r):null;if(!e&&t.hasAttribute(s)&&(console.warn(`Attribute ${s} is deprecated for binding! Use the ${r} key attribute instead.`,t),e=t.getAttribute(s)),!e)return"";if(!e.startsWith(a)){const n=t.tagName.toLowerCase();return console.error([`Invalid chain found for ${n} (chain: "${e}")!`,`A valid chain must start with "${a}".`].join("\n")),""}return e}function v(t,e){return t=t.split("@").join(""),e=e.split("@").join(""),t&&e?`@${t}.${e}`:e?"@"+e:t?"@"+t:"@"}function g(t,e,n){d.set(t,{chain:e,changeHandler:n})}function p(t,e,n){d.set(t,{expression:e,changeHandler:n})}function m(t,e){const n=t=>{if(t.childNodes.length>0)for(const i of t.childNodes){if(d.has(i)){const t=d.get(i);t.chain?e.offChange(t.chain,t.changeHandler):e.offChangeExpressionChain(t.expression,t.changeHandler),d.delete(i)}n(i)}};n(t)}function y(t,e,n){let i=null;for(;t;){if(t.matches(e)){i=t;break}if(n&&t.matches(n))break;t=t.parentElement}return i}function $(t,{key:e,value:n}){if(!c.includes(e))if(["innerHTML","innerText"].includes(e)&&console.warn(`Model property "${e}" can be short handed, try "${e.substr(5).toLowerCase()}" instead!\n`,"target element:",t),["data-tag","data-view-model"].includes(e)&&console.warn(`Model property "${e}" can be shorthanded, try "${e.substr(5)}" instead!\n`,"target model:",t.getAttribute("data-model")),function(t){return["value","innerText","innerHTML"].includes(t)}(e=function(t){switch(t){case"model":return"data-view-model";case"tag":return"data-tag";case"text":return"innerText";case"html":return"innerHTML";default:return t}}(e))){if("INPUT"===t.tagName&&"file"===t.getAttribute("type")&&"value"===e)return;t[e]=n}else if("class"!==e)"boolean"!=typeof n?"string"!=typeof n?"object"!=typeof n||(t[e]=n):t.setAttribute(e,n):n?t.setAttribute(e,""):t.removeAttribute(e);else{if(""===n)return void(t.className="");if("string"==typeof n)return void t.classList.add(n);if("object"==typeof n){for(const[e,i]of Object.entries(n))i?t.classList.add(e):t.classList.remove(e);return}}}function b(t,e){return"input"===t.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")&&"checked"===e||"value"===e}function k(t,e,n=a,i=null){t.tagName.startsWith(u.toUpperCase())||Array.from(t.attributes).forEach((o=>{const c=o.nodeName;let u=o.nodeValue;if(c===r||c===s)return;if(!u.startsWith(n))return;if(u=u.slice(1),i&&(u=I(i,u)),$(t,{key:c,value:e.getChainValue(u)}),f.includes(t.tagName.toLowerCase()))return;n===a&&b(t,c)&&M(t,e,u);const l=()=>{$(t,{key:c,value:e.getChainValue(u)})};if(e.onChange(u,l),g(t,u,l),e.hasExpression(u)){$(t,{key:c,value:e.evaluateExpression(u)}),n===a&&b(t,c)&&M(t,e,u);const i=()=>{$(t,{key:c,value:e.evaluateExpression(u)})};e.onChangeExpressionChain(u,i),p(t,u,i)}}))}function T(t){t.nodeType===Node.ELEMENT_NODE&&(t.removeAttribute("slot"),t.removeAttribute("hidden"))}function M(t,e,n){const i=t.tagName.toLowerCase();["input","textarea"].includes(i)?t.addEventListener("input",(o=>{const r=o.target;"input"!==i||"checkbox"!==t.getAttribute("type")?"input"!==i||"file"!==t.getAttribute("type")?e.setChainValue(n,r.value):e.setChainValue(n,Array.from(r.files)):e.setChainValue(n,r.checked)})):"select"===i&&t.addEventListener("change",(t=>{e.setChainValue(n,t.target.value)}))}function x(t,e,n){if(!e.getChainValue(n))return;const i="input"===t.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")?"checked":"value";M(t,e,`${n}.${i}`)}function A(t,e){return Array.from(t.attributes).some((t=>t.nodeName===e))}function j(t,e){return t.filter((t=>t.getAttribute("slot")===e))}function w(t,e){return j(t,e).map((t=>t.outerHTML)).join("")}function N(t,e){for(m(t,e);t.children.length>0;)t.children[0].remove()}function H(t,e){for(m(t,e);t.childNodes.length>0;)t.childNodes[0].remove()}function I(...t){return t.filter((t=>null!=t)).filter(String).join(".")}function C(t){let e;if("function"==typeof t.detail?e=t.detail:t.detail&&"function"==typeof t.detail.callback&&(e=t.detail.callback),e)return e;console.warn("Invalid callback for event",t)}function L(e,n){e.addEventListener(t,(t=>{t.stopImmediatePropagation();const i=C(t);if(!i)return;const o=Array.from(t.composedPath()),r=Array.from(e.children).findIndex((t=>-1!==o.indexOf(t)));i(void 0,I(n,r))}))}class P{constructor(t,{model:e,translationModel:n,tags:i,routing:o,chain:r}){this.listeners={getModel:()=>null,getTranslationModel:()=>null,getTags:()=>null,getRouting:()=>null,getParentChain:()=>null},this.host=t,e&&(this.listeners.getModel=t=>{t.stopImmediatePropagation();const n=C(t);if(n){if(t.detail.chain){let i=t.detail.chain;return i.startsWith(a)?(i=i.slice(1),void n(void 0,e.getChainValue(i))):(console.warn([`Invalid chain found for ${t} (chain: "${i}")!`,`A valid chain must start with "${a}".`].join("\n")),void n(void 0,e))}n(void 0,e)}}),n&&(this.listeners.getTranslationModel=t=>{t.stopImmediatePropagation();const e=C(t);if(e){if(t.detail.chain){let i=t.detail.chain;return i.startsWith(l)?(i=i.slice(1),void e(void 0,n.getChainValue(i))):(console.warn([`Invalid chain found for ${t} (chain: "${i}")!`,`A valid chain must start with "${l}".`].join("\n")),void e(void 0,n))}e(void 0,n)}}),i&&(this.tags=i,this.listeners.getTags=t=>{t.stopImmediatePropagation();const e=C(t);if(e)return t.detail.tag?this.tags[t.detail.tag]?e(void 0,this.tags[t.detail.tag]):e(`There is no page tag "${t.detail.tag}" registered in webcardinal.json`):e(void 0,this.tags)}),o&&(this.routing=o,this.listeners.getRouting=t=>{t.stopImmediatePropagation();const e=C(t);e&&e(void 0,this.routing)}),void 0!==r&&(this.chain=r,this.listeners.getParentChain=t=>{t.stopImmediatePropagation();const e=C(t);e&&e(void 0,this.chain)})}get getModel(){const t=e;return{add:()=>this.host.addEventListener(t,this.listeners.getModel),remove:()=>this.host.removeEventListener(t,this.listeners.getModel),eventName:t}}get getTranslationModel(){const t=n;return{add:()=>this.host.addEventListener(t,this.listeners.getTranslationModel),remove:()=>this.host.removeEventListener(t,this.listeners.getTranslationModel),eventName:t}}get getParentChain(){const e=t;return{add:()=>this.host.addEventListener(e,this.listeners.getParentChain),remove:()=>this.host.removeEventListener(e,this.listeners.getParentChain),eventName:e}}get getTags(){if(!this.tags)return;const t=i;return{add:()=>this.host.addEventListener(t,this.listeners.getTags),remove:()=>this.host.removeEventListener(t,this.listeners.getTags),eventName:t}}get getRouting(){if(!this.routing)return;const t=o;return{add:()=>this.host.addEventListener(t,this.listeners.getRouting),remove:()=>this.host.removeEventListener(t,this.listeners.getRouting),eventName:t}}}export{P as C,M as a,k as b,x as c,j as d,w as e,N as f,y as g,H as h,A as i,I as j,h as k,g as l,v as m,p as n,m as o,C as p,L as q,T as r,$ as s}